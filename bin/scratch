#!/usr/bin/env ruby

$:.unshift File.join(File.dirname(__FILE__),'..') 
require 'lib/collection'
require 'lib/log'
require 'rubygems'
require 'gli'
include GLI::App

version '0.0.1'

desc 'Make backups'
arg_name '<collection_path>'
command :backup do |b|
  b.switch :f, :force, :desc => 'make backups even if not yet needed'
  b.action do |gopts, opts, args|
    collection = Collection.new(args.first)
    opts[:force] ? collection.backup : collection.try_backup
  end
end

desc 'Delete stale backups to conserve space'
arg_name '<collection_path>'
command :prune do |b|
  b.action do |gopts, opts, args|
    collection = Collection.new(args.first)
    collection.prune
  end
end

desc 'Show information about backups'
arg_name '<collection_path>'
command :report do |b|
  b.action do |gopts, opts, args|
    collection = Collection.new(args.first)
    collection.report
  end
end

exit run(ARGV)

